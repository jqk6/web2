<!DOCTYPE html>

<html>
	<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>ffmpeg</title>
	<script type="text/javascript" src="./jquery-1.4.2.min.js"></script>
	<script>
	function funcFocus1() {
		$("#idTitle").select();
		$("#idTitle").focus();
	}

	function funcFocus2() {
		$("#idUrl").select();
		$("#idUrl").focus();
	}

	function funcClear1() {
		$("#idTitle").val("");
		funcFocus1();
	}

	function funcClear2() {
		$("#idUrl").val("");
		funcFocus2();
	}

	function funcGenerateFFmpeg() {

		var tt = $("#idTitle").val();
		tt = tt.trim();
		if (tt.length === 0) {
			funcFocus1();
			return;
		}

		var uu = $("#idUrl").val();
		uu = uu.trim();
		if (uu.length === 0) {
			funcFocus2();
			return;
		}

		// Windows7中，文件名不能包含的字符 \ / : * ? " < > |
		tt = tt.replaceAll (" ", "_");
		tt = tt.replaceAll ("\\", "_");
		tt = tt.replaceAll ("/", "_");
		tt = tt.replaceAll (":", "_");
		tt = tt.replaceAll ("*", "_");
		tt = tt.replaceAll ("?", "_");
		tt = tt.replaceAll ("\"", "_");
		tt = tt.replaceAll ("<", "_");
		tt = tt.replaceAll (">", "_");
		tt = tt.replaceAll ("|", "_");
		var ii;
		for (ii=0;ii<10;ii++){
			tt = tt.replaceAll ("__", "_");
		}

		// ffmpeg -i https://xxx.xxx.org/media/audio/xxx.m3u8 -c copy -vn -acodec libmp3lame -ac 2 -qscale:a 4 -ar 8000 XXX.mp3
		var strText = 'ffmpeg -i ' + uu + ' -c copy -vn -acodec libmp3lame -ac 2 -qscale:a 4 -ar 8000 \"'+tt+'\".mp3';
		
		// 输出结算结果
		$("#idStdout").html(
				"<i><b>TITLE:&nbsp;&nbsp;</b>" + tt + "</i></br>\n" + 
				"<i><b>URL:&nbsp;&nbsp;</b>" + uu + "</i></br>\n" + 
				"<b><font color=blue>" + strText + "</font></b></br>\n" + 
				"<hr>\n" +
				$("#idStdout").html());

		// 将所有LOG保存在localStorage中，以免误操作或刷新丢失
		localStorage.setItem("ffmpeg_idStdout", $("#idStdout").html());

		$("#idTitle").val("");
		$("#idUrl").val("");
		funcFocus1();
	}

	function funcClearAllLogs(){
		if ($("#idStdout").html()){
			var answer = window.confirm("Remove all of the history ffmpeg commands!!!");
			if (answer) {
				$("#idStdout").html("");
				localStorage.removeItem("ffmpeg_idStdout"); // 删除localStorage中的该项，注意不能用localStorage.clear()清空全部
				funcFocus1();
			}
		}
	}

	</script>
	</head>
	<body>
		<!-- version //-->
		<p>FFmpeg V: 12</p>
		<hr>
		<!-- FORM //-->
		<form id="idForm1">
		<table>
			<tr>
				<td><b> TITLE: </b></td>
				<td><input id="idTitle" type="text" size="66"></td>
				<td><input id="idBtn" type="button" value="Clear" onclick="funcClear1(this);"></td>
				<td><input id="idBtn" type="button" value="Focus" onclick="funcFocus1(this);"></td>
			</tr>
			<tr>
				<td><b> URL: </b></td>
				<td><input id="idUrl" type="text" size="66"></td>
				<td><input id="idBtn" type="button" value="Clear" onclick="funcClear2(this);"></td>
				<td><input id="idBtn" type="button" value="Focus" onclick="funcFocus2(this);"></td>
			</tr>
		</table>
		</br>
		<!-- BUTTON //-->
		<table>
		<tr>
			<td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
			<td><input id="idBtn" type="button" value="Generate FFmpeg" onclick="funcGenerateFFmpeg(this);" style="height:30px;"></td>
			<td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
			<td><input id="idBtn" type="button" value="Clear All Logs" onclick="funcClearAllLogs(this);" style="height:30px;"></td>
		</tr>
		</table>
		</form>
		<hr>
		<!-- LOGGING //-->
		<p id="idStdout"></p>
		<script>
			// READY
			$(document).ready(function() {
				funcFocus1();
				// 从localStorage中读出上次的LOG
				$("#idStdout").html(localStorage.getItem("ffmpeg_idStdout"));
			});	
		</script>
	</body>
</html>
